<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<!-- Fragmento editable por página -->
<head layout:fragment="head">
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title layout:fragment="title">D&D Nature’s</title>

  <!-- === CSS GLOBAL === -->
  <link rel="stylesheet"
        href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css"/>
  <!-- Incluye CSS AdminLTE y dependencias -->
  <link rel="stylesheet" href="/plugins/fontawesome-free/css/all.min.css"/>
  <link rel="stylesheet" href="/dist/css/adminlte.min.css"/>
  <!-- Select2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

  <style>
    .main-sidebar .sidebar { display:flex; flex-direction:column; height:100vh; }
    .main-sidebar .sidebar nav { flex:1; overflow-y:auto; }
    .sidebar-footer { padding:1.25rem 0; }
    .sidebar-footer .nav-link { display:flex; align-items:center; justify-content:center; gap:.5rem; color:#dc3545; font-weight:500; }

    /* CSS DE VENTA - SOLO LO TIENE VENTA */
    /* Estilos generales para los modales Bootstrap/AdminLTE */
        .modal-xl {
            max-width: 900px; /* Ancho para el modal de venta */
        }
        .bg-light {
            background-color: #f8f9fa !important; /* Color para campos readonly */
        }
        .form-control-static {
            padding-top: .5rem;
            padding-bottom: .5rem;
            margin-bottom: 0;
            line-height: 1.25;
        }
        /* Nuevo estilo para filas de ventas canceladas */
        .cancelled-sale {
            background-color: #f8d7da !important; /* Rojo claro para indicar cancelación */
            color: #721c24 !important; /* Texto oscuro para contraste */
        }
        .cancelled-sale a, .cancelled-sale button {
            color: #721c24 !important; /* Asegura que los enlaces y botones también se vean afectados */
        }
  </style>

  <!-- === SCRIPTS CABECERA GLOBAL (si los hay) === -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- === STYLES POR PÁGINA === -->
  <th:block layout:insert="~{::styles}"/>

</head>
<body class="hold-transition sidebar-mini layout-fixed">

<div class="wrapper">

  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button">
          <i class="fas fa-bars"></i>
        </a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a th:href="@{ / }" class="nav-link">Inicio</a>
      </li>
    </ul>
    <ul class="navbar-nav ml-auto">
      <li class="nav-item">
          <span th:if="${currentUser != null}"
                th:text="${currentUser.nombre} + ' ' + ${currentUser.apPaterno} + ' ' + ${currentUser.apMaterno}">
            Nombre Completo
          </span>
        <span th:unless="${currentUser != null}" sec:authentication="name">
            Usuario
          </span>
      </li>
    </ul>
  </nav>

  <!-- Sidebar -->
  <aside class="main-sidebar sidebar-light-success elevation-4">
    <a th:href="@{ / }" class="brand-link">
      <img src="/dist/img/Logo.png" alt="Logo" class="brand-image">
      <span class="brand-text font-weight-light">&nbsp;</span>
    </a>

    <div class="sidebar">
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu">

          <!-- MANTENIMIENTO -->
          <li class="nav-item has-treeview"
              sec:authorize="hasAnyAuthority('VER_USUARIOS','GESTION_ROLES','VER_CLIENTES',
                            'VER_PROVEEDORES','VER_IGV','VER_PRODUCTOS',
                            'VER_CATEGORIAS','VER_MERMA')"
              th:classappend="${(currentUri.startsWith('/usuarios')
                              or currentUri.startsWith('/roles')
                              or currentUri.startsWith('/clientes')
                              or currentUri.startsWith('/proveedores')
                              or currentUri.startsWith('/tasa')
                              or currentUri.startsWith('/productos')
                              or currentUri.startsWith('/categorias')
                              or currentUri.startsWith('/merma')
                            )} ? 'menu-open' : ''">
            <a href="#" class="nav-link"
               th:classappend="${(currentUri.startsWith('/usuarios')
                               or currentUri.startsWith('/roles')
                               or currentUri.startsWith('/clientes')
                               or currentUri.startsWith('/proveedores')
                               or currentUri.startsWith('/tasa')
                               or currentUri.startsWith('/productos')
                               or currentUri.startsWith('/categorias')
                               or currentUri.startsWith('/merma')
                             )} ? 'active' : ''">
              <i class="nav-icon fas fa-tools"></i>
              <p>Mantenimiento <i class="right fas fa-angle-left"></i></p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item" sec:authorize="hasAuthority('VER_USUARIOS')">
                <a th:href="@{/usuarios}" class="nav-link"
                   th:classappend="${currentUri.startsWith('/usuarios')} ? 'menu-open'">
                  <i class="fas fa-user-cog nav-icon"></i><p>Usuarios</p>
                </a>
              </li>
              <li class="nav-item" sec:authorize="hasAuthority('GESTION_ROLES')">
                <a th:href="@{/roles}" class="nav-link"
                   th:classappend="${currentUri.startsWith('/roles')} ? 'menu-open'">
                  <i class="fas fa-user-shield nav-icon"></i><p>Roles</p>
                </a>
              </li>
              <li class="nav-item" sec:authorize="hasAuthority('VER_CLIENTES')">
                <a th:href="@{/clientes}" class="nav-link"
                   th:classappend="${currentUri.startsWith('/clientes')} ? 'menu-open'">
                  <i class="fas fa-users nav-icon"></i><p>Clientes</p>
                </a>
              </li>
              <li class="nav-item" sec:authorize="hasAuthority('VER_PROVEEDORES')">
                <a th:href="@{/proveedores}" class="nav-link"
                   th:classappend="${currentUri.startsWith('/proveedores')} ? 'menu-open'">
                  <i class="fas fa-truck nav-icon"></i><p>Proveedores</p>
                </a>
              </li>
              <li class="nav-item" sec:authorize="hasAuthority('VER_IGV')">
                <a th:href="@{/tasa}" class="nav-link"
                   th:classappend="${currentUri.startsWith('/tasa')} ? 'menu-open'">
                  <i class="fas fa-percentage nav-icon"></i><p>IGV</p>
                </a>
              </li>
              <li class="nav-item" sec:authorize="hasAuthority('VER_PRODUCTOS')">
                <a th:href="@{/productos}" class="nav-link"
                   th:classappend="${currentUri.startsWith('/productos')} ? 'menu-open'">
                  <i class="fas fa-box-open nav-icon"></i><p>Productos</p>
                </a>
              </li>
              <li class="nav-item" sec:authorize="hasAuthority('VER_CATEGORIAS')">
                <a th:href="@{/categorias}" class="nav-link"
                   th:classappend="${currentUri.startsWith('/categorias')} ? 'menu-open'">
                  <i class="fas fa-tags nav-icon"></i><p>Categorías</p>
                </a>
              </li>
              <li class="nav-item" sec:authorize="hasAuthority('VER_MERMA')">
                <a th:href="@{/merma}" class="nav-link"
                   th:classappend="${currentUri.startsWith('/merma')} ? 'menu-open'">
                  <i class="fas fa-trash-alt nav-icon"></i><p>Merma</p>
                </a>
              </li>
            </ul>
          </li>

          <!-- COMPRA -->
          <li class="nav-item has-treeview" sec:authorize="hasAuthority('VER_COMPRAS')"
              th:classappend="${(currentUri.startsWith('/documento-compra'))} ? 'menu-open' : ''">
            <a href="#" class="nav-link"
               th:classappend="${(currentUri.startsWith('/documento-compra'))} ? 'active' : ''">
              <i class="nav-icon fas fa-file-invoice-dollar"></i>
              <p>Registro de compra <i class="right fas fa-angle-left"></i></p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a th:href="@{/documento-compra}" class="nav-link" th:classappend="${currentUri.startsWith('/documento-compra')} ? 'menu-open'">
                  <i class="fas fa-file-alt nav-icon"></i><p>Documento de compra</p>
                </a>
              </li>
            </ul>
          </li>

          <!-- VENTA -->
          <li class="nav-item has-treeview" sec:authorize="hasAuthority('VER_VENTAS')"
              th:classappend="${(currentUri.startsWith('/ventas'))} ? 'menu-open' : ''">
            <a href="#" class="nav-link" th:classappend="${(currentUri.startsWith('/ventas'))} ? 'active' : ''">
              <i class="nav-icon fas fa-shopping-cart"></i>
              <p>Registro de venta <i class="right fas fa-angle-left"></i></p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a th:href="@{/ventas}" class="nav-link" th:classappend="${currentUri.startsWith('/ventas')} ? 'menu-open'">
                  <i class="fas fa-receipt nav-icon"></i><p>Ventas</p>
                </a>
              </li>
            </ul>
          </li>

          <!-- INFO EMPRESA -->
          <li class="nav-item" sec:authorize="hasAuthority('VER_INFO_EMPRESA')"
              th:classappend="${currentUri.startsWith('/informacion-empresa')} ? 'menu-open' : ''">
            <a th:href="@{/informacion-empresa}" class="nav-link" th:classappend="${currentUri.startsWith('/informacion-empresa')} ? 'active' : ''">
              <i class="nav-icon fas fa-building"></i><p>Información de la Empresa</p>
            </a>
          </li>

        </ul>
      </nav>

      <!-- footer siempre abajo -->
      <div class="sidebar-footer text-center">
        <a th:href="@{/logout}" class="nav-link text-danger d-inline-flex align-items-center">
          <i class="fas fa-sign-out-alt mr-2"></i><span>Cerrar sesión</span>
        </a>
      </div>
    </div>
  </aside>


  <!-- Aquí inyectas el contenido de cada página -->
  <div class="content-wrapper content" layout:fragment="content"></div>

  <footer class="main-footer text-center">
    <strong>Copyright &copy; 2025 D&D Nature's.</strong> Todos los derechos reservados.
  </footer>

</div>

<!-- 1) Scripts globales (jQuery primero!!) -->
<script src="/plugins/jquery/jquery.min.js"></script>
<script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/dist/js/adminlte.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<th:block layout:fragment="scripts"/>
</body>
</html>
